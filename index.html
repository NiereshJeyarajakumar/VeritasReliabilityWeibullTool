<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Weibull Distribution Visualizer</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body {
  font-family: Arial, sans-serif;
  max-width: 950px;
  margin: 30px auto;
  color: #000;
}
.card {
  background: transparent;
  border: 1px solid #000;
  border-radius: 8px;
  padding: 0;
  margin: 12px 0;
  overflow: hidden;
}

/* ✅ HEADER STYLE */
.card h3 {
  margin: 0;
  padding: 12px 18px;
  background: #0B1C36;
  color: #C2965B;
  font-weight: 700;
}

/* Inner padding for card content */
.card > *:not(h3) {
  padding: 18px;
}

input[type=number] {
  width: 100px;
  padding: 6px;
  border: 1px solid #cbd5e1;
  border-radius: 6px;
  margin: 0 6px;
}

/* ✅ Buttons not bold */
button {
  background: #C2965B;
  color: #000;
  border: none;
  border-radius: 10px;
  padding: 10px 16px;
  cursor: pointer;
  font-weight: 400;
}
button:hover { opacity:.9 }

/* Tabs */
.tabs { display:flex;flex-wrap:wrap;gap:6px;margin-top:8px }
.tabs button {
  background:#C2965B;color:#000;border:none;border-radius:999px;
  padding:8px 14px;font-weight:400;cursor:pointer;
}
.tabs button.active { background:#000;color:#fff }

/* Plot title */
.plot-title {
  font-weight:700;margin:10px 0 5px;text-align:center;font-size:16px;
}

#exportBtn { margin-top:10px;background:#C2965B;color:#000 }

th {
  text-align: left;
  font-weight: 700;
  padding-bottom: 4px;
}
td { padding: 4px 0 }
</style>
</head>

<body>

<div class="card">
  <h3>Weibull Distributions</h3>
  <div>
    <p>Enter up to three Weibull distributions and select which to display on the plots.</p>

    <table style="width:100%;border-collapse:collapse;margin-top:10px">
      <thead>
        <tr>
          <th style="width:20%">Display</th>
          <th>η (Scale)</th>
          <th>β (Shape)</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><input type="checkbox" id="use1" checked></td>
          <td><input type="number" id="e1" value="1000" step="1"></td>
          <td><input type="number" id="b1" value="1.5" step="0.01"></td>
        </tr>
        <tr>
          <td><input type="checkbox" id="use2"></td>
          <td><input type="number" id="e2" value="1200" step="1"></td>
          <td><input type="number" id="b2" value="2.5" step="0.01"></td>
        </tr>
        <tr>
          <td><input type="checkbox" id="use3"></td>
          <td><input type="number" id="e3" value="800" step="1"></td>
          <td><input type="number" id="b3" value="4.0" step="0.01"></td>
        </tr>
      </tbody>
    </table>

    <div style="margin-top:12px">
      <button id="plotBtn" type="button">Plot Distributions</button>
    </div>
  </div>
</div>

<div class="card" id="resultsCard" style="margin-top:16px;">
  <h3>Results (MTBF)</h3>
  <div>
    <table style="width:100%;border-collapse:collapse;margin-top:10px">
      <thead>
        <tr>
          <th>Distribution</th>
          <th>β (Shape)</th>
          <th>η (Scale)</th>
          <th>MTBF</th>
        </tr>
      </thead>
      <tbody id="resultsBody">
        <tr><td>Dist 1</td><td>–</td><td>–</td><td>–</td></tr>
        <tr><td>Dist 2</td><td>–</td><td>–</td><td>–</td></tr>
        <tr><td>Dist 3</td><td>–</td><td>–</td><td>–</td></tr>
      </tbody>
    </table>
  </div>
</div>

<div class="card">
  <h3>Plots</h3>
  <div>
    <div class="tabs">
      <button data-target="pdf" class="active">PDF</button>
      <button data-target="cdf">CDF</button>
      <button data-target="rel">Reliability</button>
      <button data-target="haz">Hazard</button>
    </div>

    <div class="plot-title" id="pdf-title">Probability Density Function</div>
    <canvas id="pdf" height="260"></canvas>

    <div class="plot-title" id="cdf-title">Cumulative Distribution Function</div>
    <canvas id="cdf" height="260"></canvas>

    <div class="plot-title" id="rel-title">Reliability Function</div>
    <canvas id="rel" height="260"></canvas>

    <div class="plot-title" id="haz-title">Hazard Rate Function</div>
    <canvas id="haz" height="260"></canvas>

    <button id="exportBtn" type="button">Download Plot</button>
  </div>
</div>

<script>
const byId = id => document.getElementById(id);
const colors = ["#000", "#C2965B", "#2b6cb0"];
let charts = {};
let panels = ["pdf", "cdf", "rel", "haz"];

// Gamma (Lanczos)
function gamma(x){
  const p=[0.99999999999980993,676.5203681218851,-1259.1392167224028,771.32342877765313,
    -176.61502916214059,12.507343278686905,-0.13857109526572012,
    9.9843695780195716e-6,1.5056327351493116e-7];
  let g=7;
  if(x<0.5) return Math.PI/Math.sin(Math.PI*x)/gamma(1-x);
  x-=1;
  let a=p[0],t=x+g+0.5;
  for(let i=1;i<g+2;i++) a+=p[i]/(x+i);
  return Math.sqrt(2*Math.PI)*Math.pow(t,x+0.5)*Math.exp(-t)*a;
}

function destroyChart(id){
  const ex = Chart.getChart(id);
  if(ex) ex.destroy();
}

function showPanel(id){
  panels.forEach(p=>{
    const active = (p===id);
    byId(p).style.display = active ? "block" : "none";
    byId(`${p}-title`).style.display = active ? "block" : "none";
    document.querySelector(`button[data-target="${p}"]`).classList.toggle("active", active);
    if(charts[p]){ charts[p].resize(); charts[p].update(); }
  });
}

function plotDistributions(){
  /* ... (unchanged existing JS logic) ... */
}

/* Create empty charts on load */
function initEmptyCharts(){
  const emptyData={datasets:[]};
  const baseOpts={
    responsive:true,
    parsing:false,
    plugins:{legend:{display:false}},
    scales:{x:{type:"linear"},y:{}}
  };

  charts.pdf = new Chart(byId("pdf"),{type:"line",data:emptyData,options:baseOpts});
  charts.cdf = new Chart(byId("cdf"),{type:"line",data:emptyData,options:baseOpts});
  charts.rel = new Chart(byId("rel"),{type:"line",data:emptyData,options:baseOpts});
  charts.haz = new Chart(byId("haz"),{type:"line",data:emptyData,options:baseOpts});
}

initEmptyCharts();
byId("plotBtn").addEventListener("click",plotDistributions);

document.querySelectorAll(".tabs button").forEach(btn=>{
  btn.addEventListener("click",()=>showPanel(btn.dataset.target));
});

document.getElementById("exportBtn").addEventListener("click", () => {
  const active = document.querySelector(".tabs button.active")?.dataset.target;
  if(!active||!charts[active]) return alert("No active chart");
  const link=document.createElement("a");
  link.download=active+"_plot.png";
  link.href=charts[active].toBase64Image();
  link.click();
});

showPanel("pdf");
</script>

<!-- ✅ Added script for height communication -->
<script>
window.onload = function() {
  function sendHeight() {
    var height = document.documentElement.scrollHeight;
    window.parent.postMessage({ iframeHeight: height }, "*");
  }
  sendHeight();
  setInterval(sendHeight, 500);
};
</script>

</body>
</html>
