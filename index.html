<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Weibull Distribution Visualizer</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
*, *::before, *::after { box-sizing: border-box; }

/* ===== Page ===== */
body {
  font-family: Arial, system-ui, sans-serif;
  margin: 20px;
  background: #ffffff;
  color: #000;
}

/* ===== Card ===== */
.card {
  background: #F2F2F2;
  border: 1px solid #e2e2e2;
  border-radius: 14px;
  padding: 22px 24px 18px; /* slightly tighter bottom padding */
  margin: 16px 0;
}

.card h3 {
  margin: 0 0 14px 0;
  font-size: 1.1rem;
  font-weight: 700;
}

/* ===== Inputs ===== */
input[type=number] {
  padding: 10px 12px;
  border-radius: 8px;
  border: 1px solid #d0d0d0;
  background: #ffffff;
  width: 120px;
  font-family: inherit;
}

/* ===== Buttons ===== */
button {
  background: #000000;
  color: #ffffff;
  border: none;
  border-radius: 10px;
  padding: 10px 16px;
  cursor: pointer;
  font-weight: 700;
}
button:hover { opacity: .9; }

/* ===== Tables ===== */
table {
  width: 100%;
  border-collapse: collapse;
}

th {
  text-align: left;
  font-weight: 700;
  padding: 8px 10px;
  background: #ffffff;
  border-bottom: 1px solid #ddd;
}

td {
  padding: 8px 10px;
  border-bottom: 1px solid #ddd;
}

/* ===== Tabs ===== */
.tabs {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-top: 6px;
  margin-bottom: 10px;
}

.tabs button {
  background: #ffffff;
  color: #000;
  border: 1px solid #d0d0d0;
  border-radius: 999px;
  padding: 8px 14px;
  font-weight: 600;
  cursor: pointer;
}

.tabs button.active {
  background: #000000;
  color: #ffffff;
  border-color: #000000;
}

/* ===== Plot panel ===== */
.plot-panel { display: none; }          /* hidden by default */
.plot-panel.active { display: block; }  /* only active shows */

/* ===== Plot titles ===== */
.plot-title {
  font-weight: 700;
  margin: 8px 0 4px;   /* tight spacing */
  text-align: center;
  font-size: 15px;
}

/* ===== Fixed-height chart wrapper ===== */
.chart-wrap {
  height: 1000px;      /* ðŸ”’ FIXED HEIGHT */
  width: 100%;
  position: relative;
  margin-bottom: 6px;  /* reduces bottom gap */
}

canvas {
  background: #ffffff;
  border: 1px solid #e2e2e2;
  border-radius: 10px;
}
</style>
</head>

<body>

<!-- ================= INPUTS ================= -->
<div class="card">
  <h3>Weibull Distributions</h3>

  <p>Enter up to three Weibull distributions and select which to display on the plots.</p>

  <table>
    <thead>
      <tr>
        <th style="width:20%">Display</th>
        <th>Î· (Scale)</th>
        <th>Î² (Shape)</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><input type="checkbox" id="use1" checked></td>
        <td><input type="number" id="e1" value="1000"></td>
        <td><input type="number" id="b1" value="1.5" step="0.01"></td>
      </tr>
      <tr>
        <td><input type="checkbox" id="use2"></td>
        <td><input type="number" id="e2" value="1200"></td>
        <td><input type="number" id="b2" value="2.5" step="0.01"></td>
      </tr>
      <tr>
        <td><input type="checkbox" id="use3"></td>
        <td><input type="number" id="e3" value="800"></td>
        <td><input type="number" id="b3" value="4.0" step="0.01"></td>
      </tr>
    </tbody>
  </table>

  <div style="margin-top:12px">
    <button id="plotBtn" type="button">Plot Distributions</button>
  </div>
</div>

<!-- ================= RESULTS ================= -->
<div class="card">
  <h3>Results (MTBF)</h3>

  <table>
    <thead>
      <tr>
        <th>Distribution</th>
        <th>Î²</th>
        <th>Î·</th>
        <th>MTBF</th>
      </tr>
    </thead>
    <tbody id="resultsBody">
      <tr><td>Dist 1</td><td>â€“</td><td>â€“</td><td>â€“</td></tr>
      <tr><td>Dist 2</td><td>â€“</td><td>â€“</td><td>â€“</td></tr>
      <tr><td>Dist 3</td><td>â€“</td><td>â€“</td><td>â€“</td></tr>
    </tbody>
  </table>
</div>

<!-- ================= PLOTS ================= -->
<div class="card">
  <h3>Plots</h3>

  <div class="tabs">
    <button type="button" data-target="pdf" class="active">PDF</button>
    <button type="button" data-target="cdf">CDF</button>
    <button type="button" data-target="rel">Reliability</button>
    <button type="button" data-target="haz">Hazard</button>
  </div>

  <!-- Panels: title + wrapper + canvas are toggled together -->
  <div class="plot-panel active" id="panel-pdf">
    <div class="plot-title">Probability Density Function</div>
    <div class="chart-wrap"><canvas id="pdf"></canvas></div>
  </div>

  <div class="plot-panel" id="panel-cdf">
    <div class="plot-title">Cumulative Distribution Function</div>
    <div class="chart-wrap"><canvas id="cdf"></canvas></div>
  </div>

  <div class="plot-panel" id="panel-rel">
    <div class="plot-title">Reliability Function</div>
    <div class="chart-wrap"><canvas id="rel"></canvas></div>
  </div>

  <div class="plot-panel" id="panel-haz">
    <div class="plot-title">Hazard Rate Function</div>
    <div class="chart-wrap"><canvas id="haz"></canvas></div>
  </div>

  <div style="margin-top:10px">
    <button id="exportBtn" type="button">Download Plot</button>
  </div>
</div>

<script>
const byId = id => document.getElementById(id);
const colors = ["#000", "#C2965B", "#2b6cb0"];
const panels = ["pdf", "cdf", "rel", "haz"];
let charts = {};
let activePanel = "pdf"; // track active chart for export

// Gamma (Lanczos)
function gamma(x){
  const p=[0.99999999999980993,676.5203681218851,-1259.1392167224028,771.32342877765313,
    -176.61502916214059,12.507343278686905,-0.13857109526572012,
    9.9843695780195716e-6,1.5056327351493116e-7];
  let g=7;
  if(x<0.5) return Math.PI/Math.sin(Math.PI*x)/gamma(1-x);
  x-=1;
  let a=p[0],t=x+g+0.5;
  for(let i=1;i<g+2;i++) a+=p[i]/(x+i);
  return Math.sqrt(2*Math.PI)*Math.pow(t,x+0.5)*Math.exp(-t)*a;
}

function destroyChart(id){
  const ex = Chart.getChart(id);
  if(ex) ex.destroy();
}

function showPanel(id){
  activePanel = id;

  // toggle entire panels so they occupy the SAME position
  panels.forEach(p=>{
    byId("panel-" + p).classList.toggle("active", p === id);
  });

  // toggle tab button style
  document.querySelectorAll(".tabs button").forEach(btn=>{
    btn.classList.toggle("active", btn.dataset.target === id);
  });

  // ensure chart sizes correctly when becoming visible
  if(charts[id]) {
    charts[id].resize();
    charts[id].update();
  }
}

function plotDistributions(){
  const dist = [];
  for(let i=1;i<=3;i++){
    if(byId("use"+i).checked){
      const beta = parseFloat(byId("b"+i).value);
      const eta  = parseFloat(byId("e"+i).value);
      if(isFinite(beta) && isFinite(eta) && beta>0 && eta>0){
        dist.push({beta, eta, color: colors[i-1], label:`Dist ${i}`});
      }
    }
  }
  if(!dist.length){
    alert("Select at least one distribution.");
    return;
  }

  // results
  const resultsBody = byId("resultsBody");
  resultsBody.innerHTML = "";
  dist.forEach(d=>{
    const mtbf = d.eta * gamma(1 + 1/d.beta);
    resultsBody.insertAdjacentHTML("beforeend",
      `<tr><td>${d.label}</td><td>${d.beta.toFixed(3)}</td><td>${d.eta.toFixed(3)}</td><td>${mtbf.toFixed(3)}</td></tr>`
    );
  });
  for(let j = dist.length + 1; j <= 3; j++){
    resultsBody.insertAdjacentHTML("beforeend",
      `<tr><td>Dist ${j}</td><td>â€“</td><td>â€“</td><td>â€“</td></tr>`
    );
  }

  // x-range
  const tmax = Math.max(...dist.map(d=>d.eta)) * 3;
  const X = Array.from({length:200}, (_,i)=> tmax*i*i/(199**2));

  const makeData = (d) => {
    return X.map(t=>{
      const z = (t/d.eta)**d.beta;
      const R = Math.exp(-z);
      return {
        pdf:(d.beta/d.eta)*(t/d.eta)**(d.beta-1)*R,
        cdf:1-R,
        rel:R,
        haz:(d.beta/d.eta)*(t/d.eta)**(d.beta-1)
      };
    });
  };

  const pdfData=[], cdfData=[], relData=[], hazData=[];
  dist.forEach(d=>{
    const Y = makeData(d);
    pdfData.push({data:X.map((t,i)=>({x:t,y:Y[i].pdf})), label:d.label, borderColor:d.color, backgroundColor:d.color, borderWidth:2});
    cdfData.push({data:X.map((t,i)=>({x:t,y:Y[i].cdf})), label:d.label, borderColor:d.color, backgroundColor:d.color, borderWidth:2});
    relData.push({data:X.map((t,i)=>({x:t,y:Y[i].rel})), label:d.label, borderColor:d.color, backgroundColor:d.color, borderWidth:2});
    hazData.push({data:X.map((t,i)=>({x:t,y:Y[i].haz})), label:d.label, borderColor:d.color, backgroundColor:d.color, borderWidth:2});
  });

  const baseOpts = {
    responsive: true,
    maintainAspectRatio: false, // ðŸ”’ container controls height (1000px)
    parsing: false,
    plugins: {
      legend: {
        display: true,
        labels: {
          usePointStyle: true,
          pointStyle: 'rectFilled',
          boxWidth: 18,
          boxHeight: 12
        }
      }
    },
    scales: {
      x: { type:"linear", title:{display:true, text:"Time"} },
      y: { title:{display:true} }
    }
  };

  destroyChart("pdf");
  charts.pdf = new Chart(byId("pdf"), { type:"line", data:{datasets:pdfData}, options:JSON.parse(JSON.stringify(baseOpts)) });
  charts.pdf.options.scales.y.title.text = "PDF";

  destroyChart("cdf");
  charts.cdf = new Chart(byId("cdf"), { type:"line", data:{datasets:cdfData}, options:JSON.parse(JSON.stringify(baseOpts)) });
  charts.cdf.options.scales.y.title.text = "CDF";

  destroyChart("rel");
  charts.rel = new Chart(byId("rel"), { type:"line", data:{datasets:relData}, options:JSON.parse(JSON.stringify(baseOpts)) });
  charts.rel.options.scales.y.title.text = "Reliability";

  destroyChart("haz");
  charts.haz = new Chart(byId("haz"), { type:"line", data:{datasets:hazData}, options:JSON.parse(JSON.stringify(baseOpts)) });
  charts.haz.options.scales.y.title.text = "Hazard";

  // ensure active panel redraws correctly
  showPanel(activePanel);
}

function initEmptyCharts(){
  const emptyData = { datasets: [] };
  const baseOpts = {
    responsive: true,
    maintainAspectRatio: false, // ðŸ”’ container controls height (1000px)
    parsing: false,
    plugins: { legend: { display: false } },
    scales: { x: { type:"linear" }, y: {} }
  };

  charts.pdf = new Chart(byId("pdf"), { type:"line", data:emptyData, options:baseOpts });
  charts.cdf = new Chart(byId("cdf"), { type:"line", data:emptyData, options:baseOpts });
  charts.rel = new Chart(byId("rel"), { type:"line", data:emptyData, options:baseOpts });
  charts.haz = new Chart(byId("haz"), { type:"line", data:emptyData, options:baseOpts });
}

initEmptyCharts();
byId("plotBtn").addEventListener("click", plotDistributions);

document.querySelectorAll(".tabs button").forEach(btn=>{
  btn.addEventListener("click", ()=> showPanel(btn.dataset.target));
});

byId("exportBtn").addEventListener("click", () => {
  const active = activePanel;
  if(!active || !charts[active]) return alert("No active chart");
  const link = document.createElement("a");
  link.download = active + "_plot.png";
  link.href = charts[active].toBase64Image();
  link.click();
});

showPanel("pdf");
</script>

  <script>
  function sendHeight() {
    const height = document.documentElement.scrollHeight;
    window.parent.postMessage(
      { height: height },
      "*"
    );
  }

  // Send on load
  window.addEventListener("load", sendHeight);

  // Send on resize
  window.addEventListener("resize", sendHeight);

  // Optional: send after dynamic changes (charts, toggles, etc.)
  const observer = new MutationObserver(sendHeight);
  observer.observe(document.body, {
    childList: true,
    subtree: true,
    attributes: true
  });
</script>
</body>
</html>


